<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WinGo Analytics Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      background: #0d1117;
      color: #f0f6fc;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
    }
    h2 { text-align: center; color: #58a6ff; }
    #chart {
      width: 100%;
      height: 80vh;
      border: 1px solid #30363d;
      border-radius: 10px;
      background-color: #161b22;
    }
    .control-box {
      text-align: center;
      margin: 10px 0;
    }
    input {
      background-color: #0d1117;
      border: 1px solid #30363d;
      color: white;
      padding: 5px;
      border-radius: 5px;
    }
    button {
      background-color: #238636;
      border: none;
      color: white;
      padding: 6px 12px;
      margin-left: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover { background-color: #2ea043; }
  </style>
</head>
<body>
  <h2>ðŸ“ˆ WinGo Analytics Dashboard</h2>
  <div id="chart"></div>

  <div class="control-box">
    <input id="seqInput" placeholder="Enter sequence e.g. 1,2,3">
    <button onclick="searchSequence()">Search Sequence</button>
    <span id="matchCount"></span>
  </div>

  <script>
    let chartData = [];
    let layout = {
      title: "Live WinGo Rounds (0â€“9)",
      xaxis: { title: "Round", showgrid: false },
      yaxis: { title: "Winning Number", range: [0, 9], dtick: 1, gridcolor: "#30363d" },
      paper_bgcolor: "#0d1117",
      plot_bgcolor: "#0d1117",
      font: { color: "#f0f6fc" }
    };

    async function loadData() {
      const res = await fetch("/api/rounds");
      const data = await res.json();
      const x = data.map(d => d.issue.slice(-6));
      const y = data.map(d => d.number);
      chartData = [{ x, y, type: 'scatter', mode: 'lines+markers', name: 'Winning Number', line: { color: '#58a6ff' } }];
      Plotly.newPlot('chart', chartData, layout);
    }

    async function searchSequence() {
      const seq = document.getElementById("seqInput").value;
      if (!seq.trim()) return;
      const res = await fetch(`/api/search?seq=${seq}`);
      const data = await res.json();
      document.getElementById("matchCount").innerText = `${data.count} matches found`;

      if (data.count > 0) {
        const traces = data.matches.map((m, idx) => ({
          x: m.map(d => d.issue.slice(-6)),
          y: m.map(d => d.number),
          type: 'scatter',
          mode: 'lines+markers',
          name: `Match ${idx + 1}`,
          line: { dash: 'dot', color: '#ff7b72' }
        }));
        Plotly.newPlot('chart', [...chartData, ...traces], layout);
      }
    }

    loadData();
    setInterval(loadData, 60000);  // Refresh every minute
  </script>
</body>
</html>
